# hwdef for STM32F411CEU6 (Black Pill)

# MCU та памʼять
MCU STM32F4xx STM32F411xx
MCUCONF_SOURCE hwdef/common/stm32f411_mcuconf.h
LD_SCRIPT hwdef/common/STM32F411.ld

FLASH_SIZE_KB 512
FLASH_RESERVE_START_KB 16
FLASH_TOTAL 507904
RAM_TOTAL 131072
BOARD_FLASH_SIZE_KB 512

# Ідентифікатор плати
APJ_BOARD_ID 8101
APJ_BOARD_TYPE STM32F411xx

# Частота кварцу
HSE_TYPE HSE_CRYSTAL
OSCILLATOR_HZ 8000000

# Стеки
MAIN_STACK 0x600
PROCESS_STACK 0x1C00

# CPU flags
CPU_FLAGS -mcpu=cortex-m4 -mfpu=fpv4-sp-d16 -mfloat-abi=hard -DARM_MATH_CM4 -u_printf_float

# USB CDC (через PA11, PA12 - автоматично)
USBID 0x1209/0x5741
SERIAL_ORDER OTG1 USART1
SERIAL_DEFAULT OTG1

# UART1 (можна розкоментувати при потребі)
#PA9  UART
#PA10 UART
#define STM32_USART1_RX_DMA_STREAM STM32_DMA_STREAM_ID(2, 2)
#define STM32_USART1_TX_DMA_STREAM STM32_DMA_STREAM_ID(2, 7)

# I2C порядок
I2C_ORDER I2C1

# PWM-вивід на PA0
PA1 TIM2_CH2 TIM2 PWM(1) GPIO(50)
define NUM_RC_OUTPUTS 1

# або, якщо PWM не треба:
# define HAL_NO_RCOUT 1


# SPI1
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1
define STM32_SPI1_RX_DMA_STREAM STM32_DMA_STREAM_ID(2, 0)
define STM32_SPI1_TX_DMA_STREAM STM32_DMA_STREAM_ID(2, 3)

# I2C1
PB6 I2C1_SCL I2C1
PB7 I2C1_SDA I2C1

# ADC
PA0 BATT_VOLTAGE_SENS ADC1 SCALE(1)
define STM32_ADC_ADC1_DMA_STREAM STM32_DMA_STREAM_ID(2, 4)
ANALOG_PIN(0, 0)  # ADC1_IN0 → PA0

define HAL_BATT_VOLT_PIN 0
define HAL_BATT_VOLT_SCALE 10

# LED (status)
PB12 LED_GREEN OUTPUT GPIO(60)
define AP_LED_PIN 50

# Резервні GPIO
PB0  EXTERN_GPIO1 INPUT GPIO(1)
PB1  EXTERN_GPIO2 INPUT GPIO(2)
PB10 EXTERN_GPIO3 INPUT GPIO(3)
PB11 EXTERN_GPIO4 INPUT GPIO(4)

# Зберігання
define HAL_STORAGE_SIZE 8192
define HAL_OS_FATFS_IO 1
define HAL_PERSISTENT_BACKEND RAM

# Прапорці
ENABLE_DFU_BOOT 0
ENABLE_CRASHDUMP 0
#INT_FLASH_PRIMARY False
HAS_EXTERNAL_FLASH_SECTIONS 0

# ChibiOS
CHIBIOS_BUILD_FLAGS USE_FAT

# Параметри за замовчуванням
define DEFAULT_PARAMETERS_FILE default_params

define AP_BOOTLOADER_FLASHING_ENABLED 0


